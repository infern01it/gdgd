import React from 'react';
import { Field, reduxForm, SubmissionError } from 'redux-form';
import InputMask from 'react-input-mask';
import classNames from 'classnames';

class CallbackForm extends React.Component {
  phoneInput({ input, meta: { touched, error }, ...custom }) {
    const hasError = touched && error !== undefined;
    const inputClassName = classNames('form-field', { 'error': hasError });
    return (
      <div className={inputClassName}>
        <InputMask
          mask="+7 (999) 999 99 99"
          maskChar="_"
          className="form-field__input"
          {...input}
          {...custom}
        />
        { hasError && <span className="form-field__msg">{error}</span> }
      </div>
    );
  }

  render() {
    const { handleSubmit } = this.props;

    return (
      <form
        className="hdr-cb-dd"
        onSubmit={handleSubmit}
      >
        <h4 className="hdr-cb-dd__title">Обратный звонок</h4>
        <div className="form-field hdr-cb-dd__input">
          <Field
            name="phone"
            component={this.phoneInput}
            placeholder="Телефон"
          />
        </div>
        <button
          type="submit"
          className="btn btn_color_ac hdr-cb-dd__button"
        >Перезвоните мне</button>
      </form>
    );
  }
}

const validate = values => {
  const errors = {};
  if (!values.phone) {
    errors.phone = 'Поле телефон обязательно для заполнения';
  } else if (!/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/i.test(values.phone)) {
    errors.phone = 'Введен неверный формат номера телефона';
  }
  return errors;
}

export default reduxForm({
  form: 'header',
  validate
})(CallbackForm);