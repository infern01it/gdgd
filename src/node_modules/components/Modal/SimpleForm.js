
import React, { Component } from 'react';
import { Field, reduxForm, SubmissionError } from 'redux-form';
import classNames from 'classnames';
import InputMask from 'react-input-mask';

class SimpleForm extends Component {

  textInput({ input, meta: { touched, error }, ...custom }) {
    const hasError = touched && error !== undefined;
    const inputClassName = classNames('form-field popup-wrap__input', { 'error': hasError });
    return (
      <div className={inputClassName}>
        <input
          className="form-field__input"
          type="text"
          {...input}
          {...custom}
        />
        { hasError && <span className="form-field__msg">{error}</span> }
      </div>
    );
  }

  phoneInput({ input, meta: { touched, error }, ...custom }) {
    const hasError = touched && error !== undefined;
    const inputClassName = classNames('form-field popup-wrap__input', { 'error': hasError });
    return (
      <div className={inputClassName}>
        <InputMask
          mask="+7 (999) 999 99 99"
          maskChar="_"
          className="form-field__input"
          {...input}
          {...custom}
        />
        { hasError && <span className="form-field__msg">{error}</span> }
      </div>
    );
  }

  render() {
    const { handleSubmit, button } = this.props;

    return (
      <form
        className="popup-wrap__form"
        onSubmit={handleSubmit}
      >
        <Field
          name="name"
          component={this.textInput}
          placeholder="Имя"
        />
        <Field
          name="phone"
          component={this.phoneInput}
          placeholder="Телефон"
        />
        <button
          type="submit"
          className="btn btn_color_ac popup-wrap__button"
        >{button}</button>
      </form>
    );
  }
};

const validate = values => {
  const errors = {};
  if (!values.name) {
    errors.name = 'Поле имя обязательно для заполнения';
  } else if (values.name.length > 45) {
    errors.name = 'Максимальная длина имени должна составлять не более 45 символов';
  }
  if (!values.phone) {
    errors.phone = 'Поле телефон обязательно для заполнения';
  } else if (!/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/i.test(values.phone)) {
    errors.phone = 'Введен неверный формат номера телефона';
  }
  return errors;
}

export default reduxForm({
  form: 'modal',
  validate
})(SimpleForm);